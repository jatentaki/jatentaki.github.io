(()=>{"use strict";var t,n=(t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)},function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});function e(t,n){return Math.ceil(t/n)*n}var r=function(t){function e(n){var e=t.call(this,n)||this;return e.name="PackingError",e}return n(e,t),e}(Error),i=function(t,n){this.size=t,this.alignment=n},o=function(t){function e(){return t.call(this,4,4)||this}return n(e,t),e.prototype.pack=function(t,n,e){if("number"!=typeof n)throw new r("Expected number, got ".concat(n));return e.setInt32(t,n,!0),t+this.size},e.prototype.unpack=function(t,n){var e=n.getInt32(t,!0);return[t+this.size,e]},e}(i),a=function(t){function e(){return t.call(this,4,4)||this}return n(e,t),e.prototype.pack=function(t,n,e){if("number"!=typeof n)throw new r("Expected number, got ".concat(n));return e.setUint32(t,n,!0),t+this.size},e.prototype.unpack=function(t,n){var e=n.getUint32(t,!0);return[t+this.size,e]},e}(i),s=function(t){function e(){return t.call(this,4,4)||this}return n(e,t),e.prototype.pack=function(t,n,e){if("number"!=typeof n)throw new r("Expected number, got ".concat(n));return e.setFloat32(t,n,!0),t+this.size},e.prototype.unpack=function(t,n){var e=n.getFloat32(t,!0);return[t+this.size,e]},e}(i),c=(new o,new a,new s),u=function(t){function e(n,e,r){var i=t.call(this,n.size*e,r)||this;return i.baseType=n,i.nValues=e,i}return n(e,t),e.prototype.pack=function(t,n,e){if(!Array.isArray(n))throw new r("Expected array, got ".concat(n));if(n.length!==this.nValues)throw new r("Expected ".concat(this.nValues," values, got ").concat(n.length));for(;t%this.alignment!=0;)t++;for(var i=0;i<n.length;i++)try{t=this.baseType.pack(t,n[i],e)}catch(t){throw t instanceof r?new r("Error packing value ".concat(i,": ").concat(t.message)):t}return t},e.prototype.unpack=function(t,n){for(var e=[];t%this.alignment!=0;)t++;for(var r=0;r<this.nValues;r++){var i=this.baseType.unpack(t,n),o=i[0],a=i[1];t=o,e.push(a)}return[t,e]},e}(i),f=function(t){function e(n){return t.call(this,n,2,8)||this}return n(e,t),e}(u),l=function(t){function e(n){return t.call(this,n,3,16)||this}return n(e,t),e}(u),h=function(t){function e(n){return t.call(this,n,4,16)||this}return n(e,t),e}(u),d=function(t){function i(n){for(var r=this,i=Math.max.apply(Math,n.map((function(t){return t[0],t[1].alignment}))),o=0,a=0,s=n;a<s.length;a++){for(var c=s[a],u=(c[0],c[1]);o%u.alignment!=0;)o++;o+=u.size}var f=e(o,i);return(r=t.call(this,f,i)||this).members=n,r}return n(i,t),i.prototype.pack=function(t,n,e){var i=this.members.map((function(t){var n=t[0];return t[1],n})),o=Object.keys(n);if(i.length!==o.length)throw new r("Expected values for ".concat(i,", got ").concat(o));if(!i.every((function(t){return o.includes(t)})))throw new r("Expected values for ".concat(i,", got ").concat(o));for(var a=t;t%this.alignment!=0;)t++;for(var s=0,c=this.members;s<c.length;s++){var u=c[s],f=u[0],l=u[1],h=n[f];try{t=l.pack(t,h,e)}catch(t){throw t instanceof r?new r("Error packing value ".concat(f,": ").concat(t.message)):t}}return t+(this.size-(t-a))},i.prototype.unpack=function(t,n){for(var e={},r=t;t%this.alignment!=0;)t++;for(var i=0,o=this.members;i<o.length;i++){var a=o[i],s=a[0],c=a[1].unpack(t,n),u=c[0],f=c[1];t=u,e[s]=f}return[t+=this.size-(t-r),e]},i}(i),p=function(t){function i(n,r){var i=this,o=n.alignment,a=r*e(n.size,n.alignment);return(i=t.call(this,a,o)||this).type=n,i.nElements=r,i.stride=e(n.size,n.alignment),i}return n(i,t),i.prototype.pack=function(t,n,e){if(!Array.isArray(n))throw new r("Expected array, got ".concat(n));if(n.length!==this.nElements)throw new r("Expected ".concat(this.nElements," values, got ").concat(n.length));for(;t%this.alignment!=0;)t++;for(var i=0;i<n.length;i++){try{t=this.type.pack(t,n[i],e)}catch(t){throw t instanceof r?new r("Error packing value ".concat(i,": ").concat(t.message)):t}t+=this.stride-this.type.size}return t},i.prototype.unpack=function(t,n){for(var e=[];t%this.alignment!=0;)t++;for(var r=0;r<this.nElements;r++){var i=this.type.unpack(t,n),o=i[0],a=i[1];t=o,e.push(a),t+=this.stride-this.type.size}return[t,e]},i}(i),v=function(t){function e(n){return t.call(this,n,4,4)||this}return n(e,t),e}(function(t){function e(n,e,r){var i,o=this;if(2===e)i=new f(n);else if(3===e)i=new l(n);else{if(4!==e)throw new Error("Invalid number of rows: ".concat(e));i=new h(n)}var a=new p(i,r);return(o=t.call(this,a.size,i.alignment)||this).baseType=n,o.nRows=e,o.nColumns=r,o}return n(e,t),e.prototype.pack=function(t,n,e){if(!Array.isArray(n))throw new r("Expected array, got ".concat(n));if(n.length!==this.nColumns)throw new r("Expected ".concat(this.nColumns," columns, got ").concat(n.length));for(;t%this.alignment!=0;)t++;for(var i=t,o=0;o<n.length;o++){if(!Array.isArray(n[o]))throw new r("Expected array, got ".concat(n[o]));for(var a=0;a<n[o].length;a++)try{t=this.baseType.pack(t,n[o][a],e)}catch(t){throw t instanceof r?new r("Error packing value ".concat(o,",").concat(a,": ").concat(t.message)):t}}return i+this.size},e.prototype.unpack=function(t,n){for(;t%this.alignment!=0;)t++;for(var e=t,r=[],i=0;i<this.nColumns;i++){for(var o=[],a=0;a<this.nRows;a++){var s=this.baseType.unpack(t,n),c=s[0],u=s[1];t=c,o.push(u)}r.push(o)}return[t+=this.size-(t-e),r]},e}(i)),y=function(){function t(n){var e=t.decodeHeader(n),r=e[0],i=e[1],o=e[2];this.numGaussians=r;var a=0;for(var s in i)s.startsWith("f_rest_")&&(a+=1);var u=a/3;this.sphericalHarmonicsDegree=Math.sqrt(u+1)-1,console.log("Detected degree",this.sphericalHarmonicsDegree,"with ",u,"coefficients per color");for(var f=[],v=0;v<3;++v)f.push("f_dc_".concat(v));for(var y=0;y<u;++y)for(v=0;v<3;++v)f.push("f_rest_".concat(v*u+y));this.gaussianLayout=new d([["position",new l(c)],["logScale",new l(c)],["rotQuat",new h(c)],["opacityLogit",c],["shCoeffs",new p(new l(c),this.nShCoeffs)]]),this.gaussianArrayLayout=new p(this.gaussianLayout,r),this.positionsArray=[],this.gaussiansBuffer=new ArrayBuffer(this.gaussianArrayLayout.size);var m=new DataView(this.gaussiansBuffer),w=0,g=0;for(y=0;y<r;y++){var x=this.readRawVertex(w,o,i),_=x[0],M=x[1];w=_,g=this.gaussianLayout.pack(g,this.arrangeVertex(M,f),m),this.positionsArray.push([M.x,M.y,M.z])}}return t.decodeHeader=function(t){for(var n=new TextDecoder,e=0,r="";;){var i=new Uint8Array(t,e,50);if(e+=50,(r+=n.decode(i)).includes("end_header"))break}for(var o=r.split("\n"),a=0,s={},c=0;c<o.length;c++){var u=o[c].trim();if(u.startsWith("element vertex")){var f=u.match(/\d+/);f&&(a=parseInt(f[0]))}else if(u.startsWith("property")){var l=u.match(/(\w+)\s+(\w+)\s+(\w+)/);if(l){var h=l[2];s[l[3]]=h}}else if("end_header"===u)break}var d=r.indexOf("end_header")+10+1;return[a,s,new DataView(t,d)]},t.prototype.readRawVertex=function(t,n,e){var r={};for(var i in e){var o=e[i];"float"===o?(r[i]=n.getFloat32(t,!0),t+=Float32Array.BYTES_PER_ELEMENT):"uchar"===o&&(r[i]=n.getUint8(t)/255,t+=Uint8Array.BYTES_PER_ELEMENT)}return[t,r]},Object.defineProperty(t.prototype,"nShCoeffs",{get:function(){if(0===this.sphericalHarmonicsDegree)return 1;if(1===this.sphericalHarmonicsDegree)return 4;if(2===this.sphericalHarmonicsDegree)return 9;if(3===this.sphericalHarmonicsDegree)return 16;throw new Error("Unsupported SH degree: ".concat(this.sphericalHarmonicsDegree))},enumerable:!1,configurable:!0}),t.prototype.arrangeVertex=function(t,n){for(var e=[],r=0;r<this.nShCoeffs;++r){for(var i=[],o=0;o<3;++o){var a=n[3*r+o];i.push(t[a])}e.push(i)}return{position:[t.x,t.y,t.z],logScale:[t.scale_0,t.scale_1,t.scale_2],rotQuat:[t.rot_0,t.rot_1,t.rot_2,t.rot_3],opacityLogit:t.opacity,shCoeffs:e}},t}();let m=1e-6,w=Float32Array;function g(t=0,n=0){const e=new w(2);return void 0!==t&&(e[0]=t,void 0!==n&&(e[1]=n)),e}let x=Float32Array;const _=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]);let M=_.get(Float32Array);function b(t,n){return(n=n||M())[0]=t[0],n[1]=t[1],n[2]=t[2],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[8]=t[8],n[9]=t[9],n[10]=t[10],n}const z=b;function S(t){return(t=t||M())[0]=1,t[1]=0,t[2]=0,t[4]=0,t[5]=1,t[6]=0,t[8]=0,t[9]=0,t[10]=1,t}function C(t,n){n=n||M();const e=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],c=t[8],u=t[9],f=t[10],l=f*a-s*u,h=-f*o+s*c,d=u*o-a*c,p=1/(e*l+r*h+i*d);return n[0]=l*p,n[1]=(-f*r+i*u)*p,n[2]=(s*r-i*a)*p,n[4]=h*p,n[5]=(f*e-i*c)*p,n[6]=(-s*e+i*o)*p,n[8]=d*p,n[9]=(-u*e+r*c)*p,n[10]=(a*e-r*o)*p,n}const k=C;function A(t,n,e){e=e||M();const r=t[0],i=t[1],o=t[2],a=t[4],s=t[5],c=t[6],u=t[8],f=t[9],l=t[10],h=n[0],d=n[1],p=n[2],v=n[4],y=n[5],m=n[6],w=n[8],g=n[9],x=n[10];return e[0]=r*h+a*d+u*p,e[1]=i*h+s*d+f*p,e[2]=o*h+c*d+l*p,e[4]=r*v+a*y+u*m,e[5]=i*v+s*y+f*m,e[6]=o*v+c*y+l*m,e[8]=r*w+a*g+u*x,e[9]=i*w+s*g+f*x,e[10]=o*w+c*g+l*x,e}const E=A;var P=Object.freeze({__proto__:null,clone:z,copy:b,create:function(t,n,e,r,i,o,a,s,c){const u=M();return u[3]=0,u[7]=0,u[11]=0,void 0!==t&&(u[0]=t,void 0!==n&&(u[1]=n,void 0!==e&&(u[2]=e,void 0!==r&&(u[4]=r,void 0!==i&&(u[5]=i,void 0!==o&&(u[6]=o,void 0!==a&&(u[8]=a,void 0!==s&&(u[9]=s,void 0!==c&&(u[10]=c))))))))),u},determinant:function(t){const n=t[0],e=t[1],r=t[2],i=t[4],o=t[5],a=t[6],s=t[8],c=t[9],u=t[10];return n*(o*u-c*a)-i*(e*u-c*r)+s*(e*a-o*r)},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]},equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<m&&Math.abs(t[1]-n[1])<m&&Math.abs(t[2]-n[2])<m&&Math.abs(t[4]-n[4])<m&&Math.abs(t[5]-n[5])<m&&Math.abs(t[6]-n[6])<m&&Math.abs(t[8]-n[8])<m&&Math.abs(t[9]-n[9])<m&&Math.abs(t[10]-n[10])<m},fromMat4:function(t,n){return(n=n||M())[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n},fromQuat:function(t,n){n=n||M();const e=t[0],r=t[1],i=t[2],o=t[3],a=e+e,s=r+r,c=i+i,u=e*a,f=r*a,l=r*s,h=i*a,d=i*s,p=i*c,v=o*a,y=o*s,m=o*c;return n[0]=1-l-p,n[1]=f+m,n[2]=h-y,n[3]=0,n[4]=f-m,n[5]=1-u-p,n[6]=d+v,n[7]=0,n[8]=h+y,n[9]=d-v,n[10]=1-u-l,n[11]=0,n},getAxis:function(t,n,e){const r=4*n;return(e=e||g())[0]=t[r+0],e[1]=t[r+1],e},getScaling:function(t,n){n=n||g();const e=t[0],r=t[1],i=t[4],o=t[5];return n[0]=Math.sqrt(e*e+r*r),n[1]=Math.sqrt(i*i+o*o),n},getTranslation:function(t,n){return(n=n||g())[0]=t[8],n[1]=t[9],n},identity:S,inverse:C,invert:k,mul:E,multiply:A,negate:function(t,n){return(n=n||M())[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n},rotate:function(t,n,e){e=e||M();const r=t[0],i=t[1],o=t[2],a=t[4],s=t[5],c=t[6],u=Math.cos(n),f=Math.sin(n);return e[0]=u*r+f*a,e[1]=u*i+f*s,e[2]=u*o+f*c,e[4]=u*a-f*r,e[5]=u*s-f*i,e[6]=u*c-f*o,t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10]),e},rotation:function(t,n){n=n||M();const e=Math.cos(t),r=Math.sin(t);return n[0]=e,n[1]=r,n[2]=0,n[4]=-r,n[5]=e,n[6]=0,n[8]=0,n[9]=0,n[10]=1,n},scale:function(t,n,e){e=e||M();const r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[4]=i*t[4],e[5]=i*t[5],e[6]=i*t[6],t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10]),e},scaling:function(t,n){return(n=n||M())[0]=t[0],n[1]=0,n[2]=0,n[4]=0,n[5]=t[1],n[6]=0,n[8]=0,n[9]=0,n[10]=1,n},set:function(t,n,e,r,i,o,a,s,c,u){return(u=u||M())[0]=t,u[1]=n,u[2]=e,u[3]=0,u[4]=r,u[5]=i,u[6]=o,u[7]=0,u[8]=a,u[9]=s,u[10]=c,u[11]=0,u},setAxis:function(t,n,e,r){r!==t&&(r=b(t,r));const i=4*e;return r[i+0]=n[0],r[i+1]=n[1],r},setDefaultType:function(t){const n=x;return x=t,M=_.get(t),n},setTranslation:function(t,n,e){return t!==(e=e||S())&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[4],e[5]=t[5],e[6]=t[6]),e[8]=n[0],e[9]=n[1],e[10]=1,e},translate:function(t,n,e){e=e||M();const r=n[0],i=n[1],o=t[0],a=t[1],s=t[2],c=t[4],u=t[5],f=t[6],l=t[8],h=t[9],d=t[10];return t!==e&&(e[0]=o,e[1]=a,e[2]=s,e[4]=c,e[5]=u,e[6]=f),e[8]=o*r+c*i+l,e[9]=a*r+u*i+h,e[10]=s*r+f*i+d,e},translation:function(t,n){return(n=n||M())[0]=1,n[1]=0,n[2]=0,n[4]=0,n[5]=1,n[6]=0,n[8]=t[0],n[9]=t[1],n[10]=1,n},transpose:function(t,n){if((n=n||M())===t){let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,n}const e=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],c=t[8],u=t[9],f=t[10];return n[0]=e,n[1]=o,n[2]=c,n[4]=r,n[5]=a,n[6]=u,n[8]=i,n[9]=s,n[10]=f,n}});let H=Float32Array;function T(t,n,e){const r=new H(3);return void 0!==t&&(r[0]=t,void 0!==n&&(r[1]=n,void 0!==e&&(r[2]=e))),r}const q=T;function B(t,n,e){return(e=e||new H(3))[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}const D=B;function F(t,n,e){return(e=e||new H(3))[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}const L=F;function Y(t,n){return(n=n||new H(3))[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}const I=Y;function O(t,n,e){e=e||new H(3);const r=t[2]*n[0]-t[0]*n[2],i=t[0]*n[1]-t[1]*n[0];return e[0]=t[1]*n[2]-t[2]*n[1],e[1]=r,e[2]=i,e}function R(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function X(t){const n=t[0],e=t[1],r=t[2];return Math.sqrt(n*n+e*e+r*r)}const j=X;function G(t){const n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r}const U=G;function V(t,n){const e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return Math.sqrt(e*e+r*r+i*i)}const Z=V;function W(t,n){const e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return e*e+r*r+i*i}const N=W;function Q(t,n){n=n||new H(3);const e=t[0],r=t[1],i=t[2],o=Math.sqrt(e*e+r*r+i*i);return o>1e-5?(n[0]=e/o,n[1]=r/o,n[2]=i/o):(n[0]=0,n[1]=0,n[2]=0),n}function J(t,n){return(n=n||new H(3))[0]=t[0],n[1]=t[1],n[2]=t[2],n}const K=J;function $(t,n,e){return(e=e||new H(3))[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}const tt=$;function nt(t,n,e){return(e=e||new H(3))[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}const et=nt;var rt=Object.freeze({__proto__:null,add:function(t,n,e){return(e=e||new H(3))[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},addScaled:function(t,n,e,r){return(r=r||new H(3))[0]=t[0]+n[0]*e,r[1]=t[1]+n[1]*e,r[2]=t[2]+n[2]*e,r},angle:function(t,n){const e=t[0],r=t[1],i=t[2],o=t[0],a=t[1],s=t[2],c=Math.sqrt(e*e+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),u=c&&R(t,n)/c;return Math.acos(u)},ceil:function(t,n){return(n=n||new H(3))[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n},clamp:function(t,n=0,e=1,r){return(r=r||new H(3))[0]=Math.min(e,Math.max(n,t[0])),r[1]=Math.min(e,Math.max(n,t[1])),r[2]=Math.min(e,Math.max(n,t[2])),r},clone:K,copy:J,create:T,cross:O,dist:Z,distSq:N,distance:V,distanceSq:W,div:et,divScalar:function(t,n,e){return(e=e||new H(3))[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n,e},divide:nt,dot:R,equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<m&&Math.abs(t[1]-n[1])<m&&Math.abs(t[2]-n[2])<m},floor:function(t,n){return(n=n||new H(3))[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n},fromValues:q,getAxis:function(t,n,e){const r=4*n;return(e=e||new H(3))[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2],e},getScaling:function(t,n){n=n||new H(3);const e=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],c=t[8],u=t[9],f=t[10];return n[0]=Math.sqrt(e*e+r*r+i*i),n[1]=Math.sqrt(o*o+a*a+s*s),n[2]=Math.sqrt(c*c+u*u+f*f),n},getTranslation:function(t,n){return(n=n||new H(3))[0]=t[12],n[1]=t[13],n[2]=t[14],n},inverse:Y,invert:I,len:j,lenSq:U,length:X,lengthSq:G,lerp:function(t,n,e,r){return(r=r||new H(3))[0]=t[0]+e*(n[0]-t[0]),r[1]=t[1]+e*(n[1]-t[1]),r[2]=t[2]+e*(n[2]-t[2]),r},lerpV:function(t,n,e,r){return(r=r||new H(3))[0]=t[0]+e[0]*(n[0]-t[0]),r[1]=t[1]+e[1]*(n[1]-t[1]),r[2]=t[2]+e[2]*(n[2]-t[2]),r},max:function(t,n,e){return(e=e||new H(3))[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},min:function(t,n,e){return(e=e||new H(3))[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},mul:tt,mulScalar:F,multiply:$,negate:function(t,n){return(n=n||new H(3))[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n},normalize:Q,random:function(t=1,n){n=n||new H(3);const e=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*i,n[1]=Math.sin(e)*i,n[2]=r*t,n},round:function(t,n){return(n=n||new H(3))[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n},scale:L,set:function(t,n,e,r){return(r=r||new H(3))[0]=t,r[1]=n,r[2]=e,r},setDefaultType:function(t){const n=H;return H=t,n},sub:D,subtract:B,transformMat3:function(t,n,e){e=e||new H(3);const r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[4]+o*n[8],e[1]=r*n[1]+i*n[5]+o*n[9],e[2]=r*n[2]+i*n[6]+o*n[10],e},transformMat4:function(t,n,e){e=e||new H(3);const r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15]||1;return e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e},transformMat4Upper3x3:function(t,n,e){e=e||new H(3);const r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[4]+o*n[8],e[1]=r*n[1]+i*n[5]+o*n[9],e[2]=r*n[2]+i*n[6]+o*n[10],e},transformQuat:function(t,n,e){e=e||new H(3);const r=n[0],i=n[1],o=n[2],a=2*n[3],s=t[0],c=t[1],u=t[2],f=i*u-o*c,l=o*s-r*u,h=r*c-i*s;return e[0]=s+f*a+2*(i*h-o*l),e[1]=c+l*a+2*(o*f-r*h),e[2]=u+h*a+2*(r*l-i*f),e},zero:function(t){return(t=t||new H(3))[0]=0,t[1]=0,t[2]=0,t}});let it=Float32Array;function ot(t,n){return(n=n||new it(16))[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}const at=ot;function st(t){return(t=t||new it(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ct(t,n){n=n||new it(16);const e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],f=t[8],l=t[9],h=t[10],d=t[11],p=t[12],v=t[13],y=t[14],m=t[15],w=h*m,g=y*d,x=c*m,_=y*u,M=c*d,b=h*u,z=i*m,S=y*o,C=i*d,k=h*o,A=i*u,E=c*o,P=f*v,H=p*l,T=a*v,q=p*s,B=a*l,D=f*s,F=e*v,L=p*r,Y=e*l,I=f*r,O=e*s,R=a*r,X=w*s+_*l+M*v-(g*s+x*l+b*v),j=g*r+z*l+k*v-(w*r+S*l+C*v),G=x*r+S*s+A*v-(_*r+z*s+E*v),U=b*r+C*s+E*l-(M*r+k*s+A*l),V=1/(e*X+a*j+f*G+p*U);return n[0]=V*X,n[1]=V*j,n[2]=V*G,n[3]=V*U,n[4]=V*(g*a+x*f+b*p-(w*a+_*f+M*p)),n[5]=V*(w*e+S*f+C*p-(g*e+z*f+k*p)),n[6]=V*(_*e+z*a+E*p-(x*e+S*a+A*p)),n[7]=V*(M*e+k*a+A*f-(b*e+C*a+E*f)),n[8]=V*(P*u+q*d+B*m-(H*u+T*d+D*m)),n[9]=V*(H*o+F*d+I*m-(P*o+L*d+Y*m)),n[10]=V*(T*o+L*u+O*m-(q*o+F*u+R*m)),n[11]=V*(D*o+Y*u+R*d-(B*o+I*u+O*d)),n[12]=V*(T*h+D*y+H*c-(B*y+P*c+q*h)),n[13]=V*(Y*y+P*i+L*h-(F*h+I*y+H*i)),n[14]=V*(F*c+R*y+q*i-(O*y+T*i+L*c)),n[15]=V*(O*h+B*i+I*c-(Y*c+R*h+D*i)),n}const ut=ct;function ft(t,n,e){e=e||new it(16);const r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],u=t[6],f=t[7],l=t[8],h=t[9],d=t[10],p=t[11],v=t[12],y=t[13],m=t[14],w=t[15],g=n[0],x=n[1],_=n[2],M=n[3],b=n[4],z=n[5],S=n[6],C=n[7],k=n[8],A=n[9],E=n[10],P=n[11],H=n[12],T=n[13],q=n[14],B=n[15];return e[0]=r*g+s*x+l*_+v*M,e[1]=i*g+c*x+h*_+y*M,e[2]=o*g+u*x+d*_+m*M,e[3]=a*g+f*x+p*_+w*M,e[4]=r*b+s*z+l*S+v*C,e[5]=i*b+c*z+h*S+y*C,e[6]=o*b+u*z+d*S+m*C,e[7]=a*b+f*z+p*S+w*C,e[8]=r*k+s*A+l*E+v*P,e[9]=i*k+c*A+h*E+y*P,e[10]=o*k+u*A+d*E+m*P,e[11]=a*k+f*A+p*E+w*P,e[12]=r*H+s*T+l*q+v*B,e[13]=i*H+c*T+h*q+y*B,e[14]=o*H+u*T+d*q+m*B,e[15]=a*H+f*T+p*q+w*B,e}const lt=ft;let ht,dt,pt;function vt(t,n,e){e=e||new it(16);let r=t[0],i=t[1],o=t[2];const a=Math.sqrt(r*r+i*i+o*o);r/=a,i/=a,o/=a;const s=r*r,c=i*i,u=o*o,f=Math.cos(n),l=Math.sin(n),h=1-f;return e[0]=s+(1-s)*f,e[1]=r*i*h+o*l,e[2]=r*o*h-i*l,e[3]=0,e[4]=r*i*h-o*l,e[5]=c+(1-c)*f,e[6]=i*o*h+r*l,e[7]=0,e[8]=r*o*h+i*l,e[9]=i*o*h-r*l,e[10]=u+(1-u)*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}const yt=vt;function mt(t,n,e,r){r=r||new it(16);let i=n[0],o=n[1],a=n[2];const s=Math.sqrt(i*i+o*o+a*a);i/=s,o/=s,a/=s;const c=i*i,u=o*o,f=a*a,l=Math.cos(e),h=Math.sin(e),d=1-l,p=c+(1-c)*l,v=i*o*d+a*h,y=i*a*d-o*h,m=i*o*d-a*h,w=u+(1-u)*l,g=o*a*d+i*h,x=i*a*d+o*h,_=o*a*d-i*h,M=f+(1-f)*l,b=t[0],z=t[1],S=t[2],C=t[3],k=t[4],A=t[5],E=t[6],P=t[7],H=t[8],T=t[9],q=t[10],B=t[11];return r[0]=p*b+v*k+y*H,r[1]=p*z+v*A+y*T,r[2]=p*S+v*E+y*q,r[3]=p*C+v*P+y*B,r[4]=m*b+w*k+g*H,r[5]=m*z+w*A+g*T,r[6]=m*S+w*E+g*q,r[7]=m*C+w*P+g*B,r[8]=x*b+_*k+M*H,r[9]=x*z+_*A+M*T,r[10]=x*S+_*E+M*q,r[11]=x*C+_*P+M*B,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}const wt=mt;var gt=Object.freeze({__proto__:null,aim:function(t,n,e,r){return r=r||new it(16),ht=ht||T(),dt=dt||T(),pt=pt||T(),Q(B(n,t,pt),pt),Q(O(e,pt,ht),ht),Q(O(pt,ht,dt),dt),r[0]=ht[0],r[1]=ht[1],r[2]=ht[2],r[3]=0,r[4]=dt[0],r[5]=dt[1],r[6]=dt[2],r[7]=0,r[8]=pt[0],r[9]=pt[1],r[10]=pt[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},axisRotate:mt,axisRotation:vt,cameraAim:function(t,n,e,r){return r=r||new it(16),ht=ht||T(),dt=dt||T(),pt=pt||T(),Q(B(t,n,pt),pt),Q(O(e,pt,ht),ht),Q(O(pt,ht,dt),dt),r[0]=ht[0],r[1]=ht[1],r[2]=ht[2],r[3]=0,r[4]=dt[0],r[5]=dt[1],r[6]=dt[2],r[7]=0,r[8]=pt[0],r[9]=pt[1],r[10]=pt[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},clone:at,copy:ot,create:function(t,n,e,r,i,o,a,s,c,u,f,l,h,d,p,v){const y=new it(16);return void 0!==t&&(y[0]=t,void 0!==n&&(y[1]=n,void 0!==e&&(y[2]=e,void 0!==r&&(y[3]=r,void 0!==i&&(y[4]=i,void 0!==o&&(y[5]=o,void 0!==a&&(y[6]=a,void 0!==s&&(y[7]=s,void 0!==c&&(y[8]=c,void 0!==u&&(y[9]=u,void 0!==f&&(y[10]=f,void 0!==l&&(y[11]=l,void 0!==h&&(y[12]=h,void 0!==d&&(y[13]=d,void 0!==p&&(y[14]=p,void 0!==v&&(y[15]=v)))))))))))))))),y},determinant:function(t){const n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],f=t[9],l=t[10],h=t[11],d=t[12],p=t[13],v=t[14],y=t[15],m=l*y,w=v*h,g=s*y,x=v*c,_=s*h,M=l*c,b=r*y,z=v*i,S=r*h,C=l*i,k=r*c,A=s*i;return n*(m*a+x*f+_*p-(w*a+g*f+M*p))+o*(w*e+b*f+C*p-(m*e+z*f+S*p))+u*(g*e+z*a+k*p-(x*e+b*a+A*p))+d*(M*e+S*a+A*f-(_*e+C*a+k*f))},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},equalsApproximately:function(t,n){return Math.abs(t[0]-n[0])<m&&Math.abs(t[1]-n[1])<m&&Math.abs(t[2]-n[2])<m&&Math.abs(t[3]-n[3])<m&&Math.abs(t[4]-n[4])<m&&Math.abs(t[5]-n[5])<m&&Math.abs(t[6]-n[6])<m&&Math.abs(t[7]-n[7])<m&&Math.abs(t[8]-n[8])<m&&Math.abs(t[9]-n[9])<m&&Math.abs(t[10]-n[10])<m&&Math.abs(t[11]-n[11])<m&&Math.abs(t[12]-n[12])<m&&Math.abs(t[13]-n[13])<m&&Math.abs(t[14]-n[14])<m&&Math.abs(t[15]-n[15])<m},fromMat3:function(t,n){return(n=n||new it(16))[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},fromQuat:function(t,n){n=n||new it(16);const e=t[0],r=t[1],i=t[2],o=t[3],a=e+e,s=r+r,c=i+i,u=e*a,f=r*a,l=r*s,h=i*a,d=i*s,p=i*c,v=o*a,y=o*s,m=o*c;return n[0]=1-l-p,n[1]=f+m,n[2]=h-y,n[3]=0,n[4]=f-m,n[5]=1-u-p,n[6]=d+v,n[7]=0,n[8]=h+y,n[9]=d-v,n[10]=1-u-l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},frustum:function(t,n,e,r,i,o,a){const s=n-t,c=r-e,u=i-o;return(a=a||new it(16))[0]=2*i/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/c,a[6]=0,a[7]=0,a[8]=(t+n)/s,a[9]=(r+e)/c,a[10]=o/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=i*o/u,a[15]=0,a},getAxis:function(t,n,e){const r=4*n;return(e=e||T())[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2],e},getScaling:function(t,n){n=n||T();const e=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],c=t[8],u=t[9],f=t[10];return n[0]=Math.sqrt(e*e+r*r+i*i),n[1]=Math.sqrt(o*o+a*a+s*s),n[2]=Math.sqrt(c*c+u*u+f*f),n},getTranslation:function(t,n){return(n=n||T())[0]=t[12],n[1]=t[13],n[2]=t[14],n},identity:st,inverse:ct,invert:ut,lookAt:function(t,n,e,r){return r=r||new it(16),ht=ht||T(),dt=dt||T(),pt=pt||T(),Q(B(t,n,pt),pt),Q(O(e,pt,ht),ht),Q(O(pt,ht,dt),dt),r[0]=ht[0],r[1]=dt[0],r[2]=pt[0],r[3]=0,r[4]=ht[1],r[5]=dt[1],r[6]=pt[1],r[7]=0,r[8]=ht[2],r[9]=dt[2],r[10]=pt[2],r[11]=0,r[12]=-(ht[0]*t[0]+ht[1]*t[1]+ht[2]*t[2]),r[13]=-(dt[0]*t[0]+dt[1]*t[1]+dt[2]*t[2]),r[14]=-(pt[0]*t[0]+pt[1]*t[1]+pt[2]*t[2]),r[15]=1,r},mul:lt,multiply:ft,negate:function(t,n){return(n=n||new it(16))[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n},ortho:function(t,n,e,r,i,o,a){return(a=a||new it(16))[0]=2/(n-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(r-e),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1/(i-o),a[11]=0,a[12]=(n+t)/(t-n),a[13]=(r+e)/(e-r),a[14]=i/(i-o),a[15]=1,a},perspective:function(t,n,e,r,i){i=i||new it(16);const o=Math.tan(.5*Math.PI-.5*t);if(i[0]=o/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,r===1/0)i[10]=-1,i[14]=-e;else{const t=1/(e-r);i[10]=r*t,i[14]=r*e*t}return i},rotate:wt,rotateX:function(t,n,e){e=e||new it(16);const r=t[4],i=t[5],o=t[6],a=t[7],s=t[8],c=t[9],u=t[10],f=t[11],l=Math.cos(n),h=Math.sin(n);return e[4]=l*r+h*s,e[5]=l*i+h*c,e[6]=l*o+h*u,e[7]=l*a+h*f,e[8]=l*s-h*r,e[9]=l*c-h*i,e[10]=l*u-h*o,e[11]=l*f-h*a,t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},rotateY:function(t,n,e){e=e||new it(16);const r=t[0],i=t[1],o=t[2],a=t[3],s=t[8],c=t[9],u=t[10],f=t[11],l=Math.cos(n),h=Math.sin(n);return e[0]=l*r-h*s,e[1]=l*i-h*c,e[2]=l*o-h*u,e[3]=l*a-h*f,e[8]=l*s+h*r,e[9]=l*c+h*i,e[10]=l*u+h*o,e[11]=l*f+h*a,t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},rotateZ:function(t,n,e){e=e||new it(16);const r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],u=t[6],f=t[7],l=Math.cos(n),h=Math.sin(n);return e[0]=l*r+h*s,e[1]=l*i+h*c,e[2]=l*o+h*u,e[3]=l*a+h*f,e[4]=l*s-h*r,e[5]=l*c-h*i,e[6]=l*u-h*o,e[7]=l*f-h*a,t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},rotation:yt,rotationX:function(t,n){n=n||new it(16);const e=Math.cos(t),r=Math.sin(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=r,n[7]=0,n[8]=0,n[9]=-r,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},rotationY:function(t,n){n=n||new it(16);const e=Math.cos(t),r=Math.sin(t);return n[0]=e,n[1]=0,n[2]=-r,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=r,n[9]=0,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},rotationZ:function(t,n){n=n||new it(16);const e=Math.cos(t),r=Math.sin(t);return n[0]=e,n[1]=r,n[2]=0,n[3]=0,n[4]=-r,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},scale:function(t,n,e){e=e||new it(16);const r=n[0],i=n[1],o=n[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=r*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=i*t[6],e[7]=i*t[7],e[8]=o*t[8],e[9]=o*t[9],e[10]=o*t[10],e[11]=o*t[11],t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},scaling:function(t,n){return(n=n||new it(16))[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},set:function(t,n,e,r,i,o,a,s,c,u,f,l,h,d,p,v,y){return(y=y||new it(16))[0]=t,y[1]=n,y[2]=e,y[3]=r,y[4]=i,y[5]=o,y[6]=a,y[7]=s,y[8]=c,y[9]=u,y[10]=f,y[11]=l,y[12]=h,y[13]=d,y[14]=p,y[15]=v,y},setAxis:function(t,n,e,r){r!==t&&(r=ot(t,r));const i=4*e;return r[i+0]=n[0],r[i+1]=n[1],r[i+2]=n[2],r},setDefaultType:function(t){const n=it;return it=t,n},setTranslation:function(t,n,e){return t!==(e=e||st())&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},translate:function(t,n,e){e=e||new it(16);const r=n[0],i=n[1],o=n[2],a=t[0],s=t[1],c=t[2],u=t[3],f=t[4],l=t[5],h=t[6],d=t[7],p=t[8],v=t[9],y=t[10],m=t[11],w=t[12],g=t[13],x=t[14],_=t[15];return t!==e&&(e[0]=a,e[1]=s,e[2]=c,e[3]=u,e[4]=f,e[5]=l,e[6]=h,e[7]=d,e[8]=p,e[9]=v,e[10]=y,e[11]=m),e[12]=a*r+f*i+p*o+w,e[13]=s*r+l*i+v*o+g,e[14]=c*r+h*i+y*o+x,e[15]=u*r+d*i+m*o+_,e},translation:function(t,n){return(n=n||new it(16))[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},transpose:function(t,n){if((n=n||new it(16))===t){let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,n}const e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],f=t[8],l=t[9],h=t[10],d=t[11],p=t[12],v=t[13],y=t[14],m=t[15];return n[0]=e,n[1]=a,n[2]=f,n[3]=p,n[4]=r,n[5]=s,n[6]=l,n[7]=v,n[8]=i,n[9]=c,n[10]=h,n[11]=y,n[12]=o,n[13]=u,n[14]=d,n[15]=m,n}});Float32Array,Float32Array;var xt=function(){function t(t,n,e,r,i,o,a){this.height=t,this.width=n,this.viewMatrix=e,this.perspective=r,this.focalX=i,this.focalY=o,this.scaleModifier=a}return t.default=function(){return new t(500,500,gt.lookAt([0,0,0],[0,0,-1],[0,1,0]),gt.perspective(Math.PI/4,1,.2,100),600,600,1)},t.prototype.dotZ=function(){var t=this.depthAxis();return function(n){return rt.dot(t,n)}},t.prototype.getPosition=function(){var t=gt.inverse(this.viewMatrix);return gt.getTranslation(t)},t.prototype.getProjMatrix=function(){var t,n=gt.clone(this.perspective);return n=gt.mul(n,(1,-1,1,1,(t=gt.create())[0]=1,t[5]=-1,t[10]=1,t[15]=1,t)),gt.multiply(n,this.viewMatrix)},t.prototype.translate=function(t,n,e){var r=gt.inverse(this.viewMatrix);gt.translate(r,[t,n,e],r),gt.inverse(r,this.viewMatrix)},t.prototype.rotate=function(t,n,e){var r=gt.inverse(this.viewMatrix);gt.rotateX(r,n,r),gt.rotateY(r,t,r),gt.rotateZ(r,e,r),gt.inverse(r,this.viewMatrix)},t.prototype.depthAxis=function(){return gt.getAxis(gt.transpose(this.viewMatrix),2)},t}(),_t=function(){function t(t,n){this.drag=!1,this.oldX=0,this.oldY=0,this.dRX=0,this.dRY=0,this.dRZ=0,this.dTX=0,this.dTY=0,this.dTZ=0,this.dirty=!0,this.camera=t,this.canvas=n,this.window=window,this.createCallbacks()}return t.default=function(n){return new t(xt.default(),n)},t.prototype.createCallbacks=function(){var t=this;this.canvas.addEventListener("mousedown",(function(n){t.drag=!0,t.oldX=n.pageX,t.oldY=n.pageY,t.setDirty(),n.preventDefault()}),!1),this.canvas.addEventListener("mouseup",(function(n){t.drag=!1}),!1),this.canvas.addEventListener("mousemove",(function(n){if(!t.drag)return!1;t.dRX=2*(n.pageX-t.oldX)*Math.PI/t.canvas.width,t.dRY=2*(n.pageY-t.oldY)*Math.PI/t.canvas.height,t.oldX=n.pageX,t.oldY=n.pageY,t.setDirty(),n.preventDefault()}),!1),this.canvas.addEventListener("wheel",(function(n){t.dTZ=.1*n.deltaY,t.setDirty(),n.preventDefault()}),!1),window.addEventListener("keydown",(function(n){"wsad".includes(n.key)&&("w"===n.key?t.dTY=-.1:"s"===n.key?t.dTY=.1:"a"===n.key?t.dTX=-.1:"d"===n.key&&(t.dTX=.1),t.setDirty(),n.preventDefault())}),!1)},t.prototype.setNewCamera=function(t){this.camera=t,this.setDirty()},t.prototype.setDirty=function(){this.dirty=!0},t.prototype.setClean=function(){this.dirty=!1},t.prototype.isDirty=function(){return this.dirty},t.prototype.getCamera=function(){return this.isDirty()&&(this.camera.translate(this.dTX,this.dTY,this.dTZ),this.camera.rotate(this.dRX,this.dRY,this.dRZ),this.dTX=this.dTY=this.dTZ=this.dRX=this.dRY=this.dRZ=0,this.setClean()),this.camera},t}();function Mt(t,n){return 2*Math.atan(n/(2*t))}var bt=function(t,n,e,r){return new(e||(e=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,s)}c((r=r.apply(t,n||[])).next())}))},zt=function(t,n){var e,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(t,a)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},St=new d([["viewMatrix",new v(c)],["projMatrix",new v(c)],["cameraPosition",new l(c)],["tanHalfFovX",c],["tanHalfFovY",c],["focalX",c],["focalY",c],["scaleModifier",c]]);function Ct(t){return[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]],[t[8],t[9],t[10],t[11]],[t[12],t[13],t[14],t[15]]]}var kt,At=function(){function t(t,n,e,r,i,o){var a=this;this.destroyCallback=null,this.canvas=t,this.interactiveCamera=n,this.adapter=r,this.device=i,this.contextGpu=o;var s="rgba16float";this.contextGpu.configure({device:i,format:s,alphaMode:"premultiplied"}),this.pointDataBuffer=i.createBuffer({size:e.gaussianArrayLayout.size,usage:GPUBufferUsage.STORAGE,mappedAtCreation:!0}),new Uint8Array(this.pointDataBuffer.getMappedRange()).set(new Uint8Array(e.gaussiansBuffer)),this.pointDataBuffer.unmap(),this.uniformBuffer=i.createBuffer({size:St.size,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});var c=function(t,n,e){var r={1:"\n    // spherical harmonic coefficients\n    const SH_C0 = 0.28209479177387814f;\n    const SH_C1 = 0.4886025119029199f;\n\n    fn compute_color_from_sh(position: vec3<f32>, sh: array<vec3<f32>, 4>) -> vec3<f32> {\n        let dir = normalize(position - uniforms.camera_position);\n        var result = SH_C0 * sh[0];\n\n        // if deg > 0\n        let x = dir.x;\n        let y = dir.y;\n        let z = dir.z;\n\n        result = result + SH_C1 * (-y * sh[1] + z * sh[2] - x * sh[3]);\n\n        // unconditional\n        result = result + 0.5;\n\n        return max(result, vec3<f32>(0.));\n    }\n",2:"\n    // spherical harmonic coefficients\n    const SH_C0 = 0.28209479177387814f;\n    const SH_C1 = 0.4886025119029199f;\n    const SH_C2 = array(\n        1.0925484305920792f,\n        -1.0925484305920792f,\n        0.31539156525252005f,\n        -1.0925484305920792f,\n        0.5462742152960396f\n    );\n\n    fn compute_color_from_sh(position: vec3<f32>, sh: array<vec3<f32>, 9>) -> vec3<f32> {\n        let dir = normalize(position - uniforms.camera_position);\n        var result = SH_C0 * sh[0];\n\n        // if deg > 0\n        let x = dir.x;\n        let y = dir.y;\n        let z = dir.z;\n\n        result = result + SH_C1 * (-y * sh[1] + z * sh[2] - x * sh[3]);\n\n        let xx = x * x;\n        let yy = y * y;\n        let zz = z * z;\n        let xy = x * y;\n        let xz = x * z;\n        let yz = y * z;\n\n        // if (sh_degree > 1) {\n        result = result +\n            SH_C2[0] * xy * sh[4] +\n            SH_C2[1] * yz * sh[5] +\n            SH_C2[2] * (2. * zz - xx - yy) * sh[6] +\n            SH_C2[3] * xz * sh[7] +\n            SH_C2[4] * (xx - yy) * sh[8];\n        \n        // unconditional\n        result = result + 0.5;\n\n        return max(result, vec3<f32>(0.));\n    }\n",3:"\n    // spherical harmonic coefficients\n    const SH_C0 = 0.28209479177387814f;\n    const SH_C1 = 0.4886025119029199f;\n    const SH_C2 = array(\n        1.0925484305920792f,\n        -1.0925484305920792f,\n        0.31539156525252005f,\n        -1.0925484305920792f,\n        0.5462742152960396f\n    );\n    const SH_C3 = array(\n        -0.5900435899266435f,\n        2.890611442640554f,\n        -0.4570457994644658f,\n        0.3731763325901154f,\n        -0.4570457994644658f,\n        1.445305721320277f,\n        -0.5900435899266435f\n    );\n\n    fn compute_color_from_sh(position: vec3<f32>, sh: array<vec3<f32>, 16>) -> vec3<f32> {\n        let dir = normalize(position - uniforms.camera_position);\n        var result = SH_C0 * sh[0];\n\n        // if deg > 0\n        let x = dir.x;\n        let y = dir.y;\n        let z = dir.z;\n\n        result = result + SH_C1 * (-y * sh[1] + z * sh[2] - x * sh[3]);\n\n        let xx = x * x;\n        let yy = y * y;\n        let zz = z * z;\n        let xy = x * y;\n        let xz = x * z;\n        let yz = y * z;\n\n        // if (sh_degree > 1) {\n        result = result +\n            SH_C2[0] * xy * sh[4] +\n            SH_C2[1] * yz * sh[5] +\n            SH_C2[2] * (2. * zz - xx - yy) * sh[6] +\n            SH_C2[3] * xz * sh[7] +\n            SH_C2[4] * (xx - yy) * sh[8];\n        \n        // We disable the 3rd degree for now because of a bug causing the entire render\n        // to be black. This appears to be a webGPU issue. If uncomment SH_C3[0...3] it works,\n        // if you uncomment SH_C3[4...6] it works, if you uncomment the whole and divide by 10\n        // it's black.\n\n        // if (sh_degree > 2) {\n        //result = result +\n        //    SH_C3[0] * y * (3. * xx - yy) * sh[9] +\n        //    SH_C3[1] * xy * z * sh[10] +\n        //    SH_C3[2] * y * (4. * zz - xx - yy) * sh[11] +\n        //    SH_C3[3] * z * (2. * zz - 3. * xx - 3. * yy) * sh[12] +\n        //    SH_C3[4] * x * (4. * zz - xx - yy) * sh[13] +\n        //    SH_C3[5] * z * (xx - yy) * sh[14] +\n        //    SH_C3[6] * x * (xx - 3. * yy) * sh[15];\n\n        // unconditional\n        result = result + 0.5;\n\n        return max(result, vec3<f32>(0.));\n    }\n"}[n];return"\n// for some reason passing these as uniform is broken\nconst canvas_height = ".concat(t.height,";\nconst canvas_width = ").concat(t.width,";\nconst sh_degree = ").concat(n,";\nconst n_sh_coeffs = ").concat(e,";\n\nstruct PointInput {\n    @location(0) position: vec3<f32>,\n    @location(1) log_scale: vec3<f32>,\n    @location(2) rot: vec4<f32>,\n    @location(3) opacity_logit: f32,\n    sh: array<vec3<f32>, n_sh_coeffs>,\n};\n\nstruct PointOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) color: vec3<f32>,\n    @location(1) uv: vec2<f32>,\n    @location(2) conic_and_opacity: vec4<f32>,\n};\n\nstruct Uniforms {\n    viewMatrix: mat4x4<f32>,\n    projMatrix: mat4x4<f32>,\n    camera_position: vec3<f32>,\n    tan_fovx: f32,\n    tan_fovy: f32,\n    focal_x: f32,\n    focal_y: f32,\n    scale_modifier: f32,\n};\n\n").concat(r,"\n\nfn sigmoid(x: f32) -> f32 {\n    if (x >= 0.) {\n        return 1. / (1. + exp(-x));\n    } else {\n        let z = exp(x);\n        return z / (1. + z);\n    }\n}\n\nfn compute_cov3d(log_scale: vec3<f32>, rot: vec4<f32>) -> array<f32, 6> {\n    let modifier = uniforms.scale_modifier;\n    let S = mat3x3<f32>(\n        exp(log_scale.x) * modifier, 0., 0.,\n        0., exp(log_scale.y) * modifier, 0.,\n        0., 0., exp(log_scale.z) * modifier,\n    );\n\n    let r = rot.x;\n    let x = rot.y;\n    let y = rot.z;\n    let z = rot.w;\n\n    let R = mat3x3<f32>(\n        1. - 2. * (y * y + z * z), 2. * (x * y - r * z), 2. * (x * z + r * y),\n        2. * (x * y + r * z), 1. - 2. * (x * x + z * z), 2. * (y * z - r * x),\n        2. * (x * z - r * y), 2. * (y * z + r * x), 1. - 2. * (x * x + y * y),\n    );\n\n    let M = S * R;\n    let Sigma = transpose(M) * M;\n\n    return array<f32, 6>(\n        Sigma[0][0],\n        Sigma[0][1],\n        Sigma[0][2],\n        Sigma[1][1],\n        Sigma[1][2],\n        Sigma[2][2],\n    );\n} \n\nfn ndc2pix(v: f32, size: u32) -> f32 {\n    return ((v + 1.0) * f32(size) - 1.0) * 0.5;\n}\n\nfn compute_cov2d(position: vec3<f32>, log_scale: vec3<f32>, rot: vec4<f32>) -> vec3<f32> {\n    let cov3d = compute_cov3d(log_scale, rot);\n\n    var t = uniforms.viewMatrix * vec4<f32>(position, 1.0);\n\n    let limx = 1.3 * uniforms.tan_fovx;\n    let limy = 1.3 * uniforms.tan_fovy;\n    let txtz = t.x / t.z;\n    let tytz = t.y / t.z;\n\n    t.x = min(limx, max(-limx, txtz)) * t.z;\n    t.y = min(limy, max(-limy, tytz)) * t.z;\n\n    let J = mat4x4(\n        uniforms.focal_x / t.z, 0., -(uniforms.focal_x * t.x) / (t.z * t.z), 0.,\n        0., uniforms.focal_y / t.z, -(uniforms.focal_y * t.y) / (t.z * t.z), 0.,\n        0., 0., 0., 0.,\n        0., 0., 0., 0.,\n    );\n\n    let W = transpose(uniforms.viewMatrix);\n\n    let T = W * J;\n\n    let Vrk = mat4x4(\n        cov3d[0], cov3d[1], cov3d[2], 0.,\n        cov3d[1], cov3d[3], cov3d[4], 0.,\n        cov3d[2], cov3d[4], cov3d[5], 0.,\n        0., 0., 0., 0.,\n    );\n\n    var cov = transpose(T) * transpose(Vrk) * T;\n\n    // Apply low-pass filter: every Gaussian should be at least\n    // one pixel wide/high. Discard 3rd row and column.\n    cov[0][0] += 0.3;\n    cov[1][1] += 0.3;\n\n    return vec3<f32>(cov[0][0], cov[0][1], cov[1][1]);\n}\n\n\n@binding(0) @group(0) var<uniform> uniforms: Uniforms;\n@binding(1) @group(1) var<storage, read> points: array<PointInput>;\n\nconst quadVertices = array<vec2<f32>, 6>(\n    vec2<f32>(-1.0, -1.0),\n    vec2<f32>(-1.0, 1.0),\n    vec2<f32>(1.0, -1.0),\n    vec2<f32>(1.0, 1.0),\n    vec2<f32>(-1.0, 1.0),\n    vec2<f32>(1.0, -1.0),\n);\n\n@vertex\nfn vs_points(@builtin(vertex_index) vertex_index: u32) -> PointOutput {\n    var output: PointOutput;\n    let pointIndex = vertex_index / 6u;\n    let quadIndex = vertex_index % 6u;\n    let quadOffset = quadVertices[quadIndex];\n    let point = points[pointIndex];\n\n    let cov2d = compute_cov2d(point.position, point.log_scale, point.rot);\n    let det = cov2d.x * cov2d.z - cov2d.y * cov2d.y;\n    let det_inv = 1.0 / det;\n    let conic = vec3<f32>(cov2d.z * det_inv, -cov2d.y * det_inv, cov2d.x * det_inv);\n    let mid = 0.5 * (cov2d.x + cov2d.z);\n    let lambda_1 = mid + sqrt(max(0.1, mid * mid - det));\n    let lambda_2 = mid - sqrt(max(0.1, mid * mid - det));\n    let radius_px = ceil(3. * sqrt(max(lambda_1, lambda_2)));\n    let radius_ndc = vec2<f32>(\n    radius_px / (canvas_height),\n    radius_px / (canvas_width),\n    );\n    output.conic_and_opacity = vec4<f32>(conic, sigmoid(point.opacity_logit));\n\n    var projPosition = uniforms.projMatrix * vec4<f32>(point.position, 1.0);\n    projPosition = projPosition / projPosition.w;\n    output.position = vec4<f32>(projPosition.xy + 2 * radius_ndc * quadOffset, projPosition.zw);\n    output.color = compute_color_from_sh(uniforms.camera_position, point.sh);\n    output.uv = radius_px * quadOffset;\n\n    return output;\n}\n\n@fragment\nfn fs_main(input: PointOutput) -> @location(0) vec4<f32> {\n    // we want the distance from the gaussian to the fragment while uv\n    // is the reverse\n    let d = -input.uv;\n    let conic = input.conic_and_opacity.xyz;\n    let power = -0.5 * (conic.x * d.x * d.x + conic.z * d.y * d.y) + conic.y * d.x * d.y;\n    let opacity = input.conic_and_opacity.w;\n\n    if (power > 0.0) {\n    discard;\n    }\n\n    let alpha = min(0.99, opacity * exp(power));\n\n    return vec4<f32>(input.color * alpha, alpha);\n}\n")}(t,e.sphericalHarmonicsDegree,e.nShCoeffs),u=i.createShaderModule({code:c});this.pipeline=i.createRenderPipeline({layout:"auto",vertex:{module:u,entryPoint:"vs_points"},fragment:{module:u,entryPoint:"fs_main",targets:[{format:s,blend:{color:{srcFactor:"one-minus-dst-alpha",dstFactor:"one",operation:"add"},alpha:{srcFactor:"one-minus-dst-alpha",dstFactor:"one",operation:"add"}}}]},primitive:{topology:"triangle-list",stripIndexFormat:void 0,cullMode:void 0}}),this.pointPositions=e.positionsArray,this.drawOrder=Array.from(Array(this.pointPositions.length).keys()),requestAnimationFrame((function(){return a.animate()}))}return t.init=function(n,e,r){return bt(this,void 0,void 0,(function(){var i,o,a,s;return zt(this,(function(c){switch(c.label){case 0:return n?[4,navigator.gpu.requestAdapter()]:[2,Promise.reject("Canvas not found!")];case 1:return(i=c.sent())?(o=e.gaussiansBuffer.byteLength,[4,i.requestDevice({requiredLimits:{maxStorageBufferBindingSize:1.5*o,maxBufferSize:1.5*o}})]):[2,Promise.reject("WebGPU is not supported on this browser!")];case 2:return(a=c.sent()).label="Main WebGPU Device",(s=n.getContext("webgpu"))?[2,new t(n,r,e,i,a,s)]:[2,Promise.reject("WebGPU context not found!")]}}))}))},t.prototype.destroy=function(){return bt(this,void 0,void 0,(function(){var t=this;return zt(this,(function(n){return[2,new Promise((function(n,e){t.destroyCallback=n}))]}))}))},t.prototype.draw=function(t){var n=this.device.createCommandEncoder(),e={colorAttachments:[{view:this.contextGpu.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},storeOp:"store",loadOp:"clear"}]},r=n.beginRenderPass(e);r.setPipeline(this.pipeline),r.setBindGroup(0,this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]})),r.setBindGroup(1,this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(1),entries:[{binding:1,resource:{buffer:this.pointDataBuffer}}]}));for(var i=0;i<this.drawOrder.length;i++){var o=this.drawOrder[i];r.draw(6,1,6*o,0)}r.end(),this.device.queue.submit([n.finish()]),null===this.destroyCallback?requestAnimationFrame(t):(this.uniformBuffer.destroy(),this.pointDataBuffer.destroy(),this.device.destroy(),this.adapter=null,this.device=null,this.contextGpu=null,this.pipeline=null,this.destroyCallback())},t.prototype.animate=function(){var t=this;if(this.interactiveCamera.isDirty()){var n=this.interactiveCamera.getCamera(),e=n.getPosition(),r=.5*this.canvas.width/n.focalX,i=.5*this.canvas.height/n.focalY,o=new ArrayBuffer(this.uniformBuffer.size),a={viewMatrix:Ct(n.viewMatrix),projMatrix:Ct(n.getProjMatrix()),cameraPosition:Array.from(e),tanHalfFovX:r,tanHalfFovY:i,focalX:n.focalX,focalY:n.focalY,scaleModifier:n.scaleModifier};St.pack(0,a,new DataView(o)),this.device.queue.writeBuffer(this.uniformBuffer,0,o,0,o.byteLength);for(var s=n.dotZ(),c=[],u=0;u<this.pointPositions.length;u++){var f=this.drawOrder[u],l=s(this.pointPositions[f]);c.push([l,f])}this.drawOrder=c.sort((function(t,n){var e=t[0],r=(t[1],n[0]);return n[1],e-r})).map((function(t){return t[0],t[1]})),this.draw((function(){return t.animate()}))}else requestAnimationFrame((function(){return t.animate()}))},t}(),Et=document.getElementById("canvas-webgpu"),Pt=_t.default(Et);document.getElementById("plyButton").addEventListener("change",(function(t){var n=t.target.files[0];n&&function(t){return new Promise((function(n,e){var r=new FileReader;r.onload=function(t){t.target&&t.target.result?"string"!=typeof t.target.result?n(t.target.result):e("Got a text file instead of a binary one"):e("Failed to load file")},r.onerror=function(t){t.target?e(t.target.error):e("Failed to load file")},r.readAsArrayBuffer(t)}))}(n).then((function(t){return n=this,e=void 0,i=function(){var n,e;return function(t,n){var e,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(t,a)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(r){switch(r.label){case 0:return kt?[4,kt.destroy()]:[3,2];case 1:r.sent(),r.label=2;case 2:return n=new y(t),[4,At.init(Et,n,Pt)];case 3:return e=r.sent(),kt=e,[2]}}))},new((r=void 0)||(r=Promise))((function(t,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(n){var e;n.done?t(n.value):(e=n.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((i=i.apply(n,e||[])).next())}));var n,e,r,i})).catch((function(t){console.error("Error loading PLY file:",t)}))})),new function(t,n,e,r){var i=this;this.currentLineId=0,this.handleFileInputChange=function(t){var n,e=null===(n=i.fileInput.files)||void 0===n?void 0:n[0];if(e){var r=new FileReader;r.onload=i.handleFileLoad,r.readAsText(e)}},this.handleFileLoad=function(t){if(t.target){var n=t.target.result,e=JSON.parse(n);i.currentLineId=0,i.listElement.innerHTML="",e.forEach((function(t){i.currentLineId++;var n,e,r,o,a,s,c,u,f,l,h,d,p,v,y,m,w,g=document.createElement("li"),x=(n=t,e=i.canvas.width,r=i.canvas.height,f=.2,l=Mt(n.fx,n.width),h=Mt(n.fy,n.height),d=Math.tan(h/2)*f,p=-d,v=Math.tan(l/2)*f,y=-v,(m=gt.create())[0]=.4/(v-y),m[5]=.4/(d-p),m[8]=(v+y)/(v-y),m[9]=(d+p)/(d-p),m[10]=100/99.8,m[11]=-20/99.8,m[14]=1,m[15]=0,w=gt.transpose(m),o=P.create.apply(P,n.rotation.flat()),a=n.position,s=o,c=gt.fromMat3(s),u=rt.mulScalar(a,-1),gt.translate(c,u,c),new xt(r,e,c,w,n.fx,n.fy,Math.max(e/n.width,r/n.height)));g.textContent=t.img_name,g.addEventListener("click",i.createCallbackForLine(x)),i.listElement.appendChild(g)}))}},this.createCallbackForLine=function(t){return function(){i.cameraSetCallback(t)}},this.fileInput=t,this.listElement=n,this.canvas=e,this.cameraSetCallback=r,this.fileInput.addEventListener("change",this.handleFileInputChange)}(document.getElementById("cameraButton"),document.getElementById("cameraList"),Et,Pt.setNewCamera.bind(Pt))})();
//# sourceMappingURL=main.js.map